---
title: "Stepping Stone Report Draft 1"
author: "Michele Claibourn, Elizabeth Mitchell, Nina Schoonover, Lee Leboeuf"
date: "2023-05-02"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(scales)
library(janitor)
library(ggthemes)

three_category_palette <- c("#E48073", "#2F7E9F", "#83DBD7")
two_category_palette <- c("#782C6A", "#83DBD7")
one_category_palette <- c("#782C6A")

# black/white/grayscale friendly
# three_category_palette <- c("#E57873", "#0D6A82", "#ADE9ED")
# two_category_palette <- c("#782C6A", "#ADE9ED")
# one_category_palette <- c("#782C6A")

```

## Introduction

### Approach

### Our Youth

### Contributions

## Education and Civic Engagement

### Kindergarteners Identified for Reading Intervention Services {.tabset}

#### Trends

```{r}
pals_kinder <- read_csv("../data/pals_kindergarten.csv")
pals_kinder_u <- read_csv("../data/pals_kindergarten_updated.csv")

pals_kinder_u %>%
  ggplot(aes(x = school_year, y = percent, color = location, group = location)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Screened Students") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Inverted - Kindergarteners at or above readiness levels
```{r}
pals_kinder <- read_csv("../data/pals_kindergarten.csv")
pals_kinder_u <- read_csv("../data/pals_kindergarten_updated.csv")

pals_kinder_u %>%
  mutate(pct_invert = 100-percent) %>% 
  ggplot(aes(x = school_year, y = pct_invert, color = location, group = location)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Screened Students") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

#### About


### Standards of Learning

#### Math, Grade 3, Grade 5, Grade 8 {.tabset}

##### Trends

###### Grade 3 Math
```{r}
# Read in data
sols <- read_csv("../data/sol_pass.csv")
miss2021 <- data.frame(division_name = c("Albemarle County", "Charlottesville City", "Virginia"),
                       school_year = c("2019-2020", "2019-2020", "2019-2020"))

# Grade 3 Plot
sols %>% 
  filter(subject == "Mathematics" & test_level == "Grade 3") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2011-2012", linetype = 2, color = "black") +
  annotate("text", x = 7.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised math standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
  
```

Source: Virginia Department of Education (VDOE). 2006 - 2021. https://p1pe.doe.virginia.gov/buildatable/testresults
       
###### Grade 5 Math
```{r}
sols %>% 
  filter(subject == "Mathematics" & test_level == "Grade 5") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2011-2012", linetype = 2, color = "black") +
  annotate("text", x = 7.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised math standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

###### Grade 8 Math
```{r}
sols %>% 
  filter(subject == "Mathematics" & test_level == "Grade 8") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2011-2012", linetype = 2, color = "black") +
  annotate("text", x = 7.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised math standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### About

#### Reading, Grades 3, 5, and 8 {.tabset}

##### Trends
###### Grade 3 Reading
```{r}
# Read in data
sols <- read_csv("../data/sol_pass.csv")
miss2021 <- data.frame(division_name = c("Albemarle County", "Charlottesville City", "Virginia"),
                       school_year = c("2019-2020", "2019-2020", "2019-2020"))

# Grade 3 Reading Plot
sols %>% 
  filter(subject == "English:Reading" & test_level == "Grade 3") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2012-2013", linetype = 2, color = "black") +
  annotate("text", x = 8.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised reading standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

###### Grade 5 Reading
```{r}
# Grade 5 Reading Plot
sols %>% 
  filter(subject == "English:Reading" & test_level == "Grade 5") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2012-2013", linetype = 2, color = "black") +
  annotate("text", x = 8.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised reading standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

###### Grade 8 Reading
```{r}
# Grade 8 Plot
sols %>% 
  filter(subject == "English:Reading" & test_level == "Grade 8") %>% 
                        bind_rows(miss2021) %>%
  ggplot(aes(x = school_year, y = pass_rate, 
                 color = division_name, group = division_name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 11.9, y = 95, size = 3, hjust = 0, color = "black", 
           label = 
"SOLs not conducted
in 2020 due to the 
COVID-19 Pandemic") +
  geom_vline(xintercept = "2012-2013", linetype = 2, color = "black") +
  annotate("text", x = 8.2, y = 10, size = 3, hjust = 0, color = "black", 
           label = 
"Revised reading standards 
released by the VDOE") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Pass Rate") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### About

### Students Eligible for Special Education Services {.tabset}

#### Trends

```{r}
sped_services <- read_csv("../data/sped_services.csv")

sped_services %>% 
  ggplot(aes(x = school_year, y = percent_sped, 
             color = division_name, group = division_name)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 60),
                     labels = label_percent(scale = 1), 
                     name = "Percent") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### English Language-Learning Students {.tabset}

#### Trends

```{r}
english_language_learners <- read_csv("../data/english_language_learners.csv")

english_language_learners %>% 
  ggplot(aes(x = school_year, y = pct_english_learners, color = locality, group=locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 60),
                     labels = label_percent(scale = 1), 
                     name = "Percent") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Percent Average Daily Attendance {.tabset}

#### Trends
```{r}
average_daily_attendance <- read_csv("../data/average_daily_attendance.csv")

average_daily_attendance %>% 
  mutate(school_year = paste0(as.character(year-1), "-", as.character(year))) %>% 
  ggplot(aes(x = school_year, y = pct_att_total, color = name, group = name)) +
  geom_vline(xintercept = "2019-2020", linetype = 2, color = "black") +
  annotate("text", x = 10.3, y = 65, size = 3, hjust = 0, color = "black", 
           label = 
"School closures for 
COVID-19 Pandemic") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(50, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### On-Time Graduation Rates {.tabset}

#### Trends
```{r}
graduation_rates <- read_csv("../data/graduation_rates.csv")

graduation_rates %>%
  mutate(school_year = as.character(cohort_year)) %>% 
  ggplot(aes(x = school_year, y = graduation_rate, color = division_name, group = division_name)) +
  geom_vline(xintercept = "2013", linetype = 2, color = "black") +
  annotate("text", x = 6.2, y = 55, size = 3, hjust = 0, color = "black", 
           label = 
"Charlottesville City Schools
extend WALK program hours") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### High School Degree Attainment {.tabset}

#### Trends
```{r}
hsdegree_attainment <- read_csv("../data/hsdegree_attainment.csv")

hsdegree_attainment %>%
  mutate(locality = str_remove(NAME, " County, Virginia| city, Virginia"), 
         locality = str_trim(locality),
         survey_period = paste0(as.character(year-5), "-", as.character(year))) %>% 
  ggplot(aes(x = survey_period, y = pcthshigherE, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(40, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Residents") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Post-Secondary Enrollment {.tabset}

#### Trends
```{r}
postsecondary_education <- read_csv("../data/postsecondary_education.csv")

# ggplot(postsecondary_education, aes(x = year, y = percentany, color = locality)) +
#   geom_line() +
#   scale_y_continuous(limits = c(50,100))

# pivot to stack 2 year and 4 year
df_long <- postsecondary_education %>% 
  mutate(enrolled4yr = enrolled4pub + enrolled4priv) %>% 
  select(year, locality, cohortsize, enrolled4yr, enrolled2yr, enrolledany) %>% 
  pivot_longer(cols = starts_with("enrolled"), names_to = "type", values_to = "number") %>% 
  mutate(percent = (number/cohortsize)*100,
         school_year = as.character(year))

# keep only 4yr and any - or - 2yr and 4yr

# ggplot(df_long, aes(x = year, y = percent, fill = type)) + 
#   geom_area() +
#   facet_wrap(~locality)

df_long %>%
  ggplot(aes(x = school_year, y = percent, 
             color = locality, 
             group = interaction(locality, type), 
             linetype = type)) +
  geom_line() +
  geom_point() +
  scale_linetype_manual(values = c(6, 1, 5)) +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1),
                     name = "Percent") +
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "", linetype = "")
```

### Registered Voters {.tabset}

#### Trends
```{r}
voter_reg <- read_csv("../data/vote_reg.csv")

voter_reg %>%
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = reg_rate, color = locality, group = locality)) +
  geom_vline(xintercept = "2000", linetype = 2, color = "black") +
  geom_vline(xintercept = "2004", linetype = 2, color = "black") +
  geom_vline(xintercept = "2008", linetype = 2, color = "black") +
  geom_vline(xintercept = "2012", linetype = 2, color = "black") +
  geom_vline(xintercept = "2016", linetype = 2, color = "black") +
  geom_vline(xintercept = "2020", linetype = 2, color = "black") +
  annotate("text", x = 5.2, y = .3, size = 3, hjust = 0, color = "black", 
           label = 
"Presidential
Elections") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  # scale_x_continuous("Year", labels = as.character(year), breaks = year) + 
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::percent,
                     name = "Percent of Adults") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

## Economic Security and Housing

### Per Capita Income {.tabset}

#### Trends
```{r}
per_cap_income <- read_csv("../data/per_cap_income.csv")

per_cap_income %>% 
  pivot_longer(cols = c("pci", "adj_pci"), names_to = "type", values_to = "number") %>%
  mutate(year = as.character(year),
         locality = str_remove(GeoName, ", VA*"), 
         locality = str_trim(locality)) %>% 
  ggplot() +
  geom_rect(aes(xmin = "2007", xmax = "2009", ymin = -Inf, ymax = Inf), alpha = .05, fill = "#f5f5f5") +
  annotate("text", x = 10.2, y = 80000, size = 3, hjust = 0, color = "black",
           label =
"Economic Recession 
(2007-2009)") +
  geom_line(aes(x = year, y = number, 
             color = locality, 
             group = interaction(locality, type), 
             linetype = type)) +
  geom_point(aes(x = year, y = number,
             color = locality, 
             group = interaction(locality, type), 
             linetype = type), ) +
  scale_linetype_manual(values = c(2, 1)) +
  scale_color_manual(values = two_category_palette) +
  scale_y_continuous(label = comma,
                     name = "Per Capita Income") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "", linetype = "", fill = "")
```

### Youth Labor Force Participation and Unemployment {.tabset}

#### Trends

##### Youth Participation in the Labor Force
```{r}
youth_employment <- read_csv("../data/youth_employment_status.csv")

youth_employment <- youth_employment %>% 
  mutate(locality = recode(name,
                          "Albemarle County, Virginia" = "Albemarle",
                          "Charlottesville city, Virginia" = "Charlottesville"),
         survey_period = paste0(as.character(year-5), "-", as.character(year)))

youth_employment %>%
  ggplot(aes(x = survey_period, y = laborforce_rate, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Youth") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Youth Unemployment
```{r}
youth_employment %>%
  ggplot(aes(x = survey_period, y = unemployment_rate, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Youth") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


### Percent of Children Living below Poverty {.tabset}

#### Trends
```{r}
child_poverty <- read_csv("../data/child_pov.csv")

child_poverty %>%
  mutate(locality = ifelse(county_fips == "000", "Virginia",
                       ifelse(county_fips == "003", "Albemarle",
                              ifelse(county_fips == "540", "Charlottesville", "Unknown"))),
         year = as.character(year)) %>% 
  ggplot(aes(x = year, y = pct_child_pov, color = locality, group = locality)) +
  geom_vline(xintercept = "2020", linetype = 2, color = "black") +
  geom_vline(xintercept = "2021", linetype = 2, color = "black") +
  annotate("text", x = 16.8, y = 85, size = 3, hjust = 0, color = "black", 
           label = 
"COVID-19 Economic
Stimulus Payments") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Children") + 
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Students Identified as Economically Disadvantaged {.tabset}

#### Trends
```{r}
economically_disadvantaged_students <- read_csv("../data/economically_disadvantaged_students.csv")

economically_disadvantaged_students %>%
  ggplot(aes(x = school_year, y = percent, color = division_name, group = division_name)) +
#   geom_vline(xintercept = "2020", linetype = 2, color = "black") +
#   annotate("text", x = 16.8, y = 85, size = 3, hjust = 0, color = "black", 
#            label = 
# "COVID-19 Economic
# Stimulus Payments") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Children") + 
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


### Cost-Burdened Renters and Homeowners {.tabset}

#### Trends
##### Renters Paying more than 30% of their Income on Housing (Rent and Utilities)
```{r}
rent_burdened <- read_csv("../data/rent_burdened.csv")

rent_burdened %>%
  mutate(locality = str_remove(NAME, " County, Virginia| city, Virginia"), 
         locality = str_trim(locality),
         survey_period = paste0(as.character(year-5), "-", as.character(year))) %>% 
  ggplot(aes(x = survey_period, y = percent_over_30, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::percent, 
                     name = "Percent of Renters") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


##### Homeowners Paying more than 30% of their Income on Housing (Mortgage payments, Taxes, Insurance, and Utilities)
```{r}
homeowner_burden <- read_csv("../data/homeowner_burden.csv")

homeowner_burden %>%
  mutate(locality = str_remove(NAME, " County, Virginia| city, Virginia"), 
         locality = str_trim(locality),
         survey_period = paste0(as.character(year-5), "-", as.character(year))) %>% 
  ggplot(aes(x = survey_period, y = pct_burden, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Homeowners") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


### People Experiencing Homelessness {.tabset}

#### Trends
```{r}
pitcount_homeless <- read_csv("../data/pitcount_homeless.csv")

pitcount_homeless %>% 
  mutate(year = as.character(year),
         locality = "Charlottesville Region") %>% 
  ggplot() +
  geom_vline(xintercept = "2012", linetype = 2, color = "black") +
  annotate("text", x = 4.2, y = 100, size = 3, hjust = 0, color = "black", 
           label = 
"Opening of The Crossings
(permanent supportive housing)") +
  geom_vline(xintercept = "2022", linetype = 2, color = "black") +
  annotate("text", x = 10.2, y = 275, size = 3, hjust = 0, color = "black", 
           label = 
"COVID-19 pandemic hightened
impact of high housing costs 
and lack of affordable housing") +
  geom_line(aes(x = year, y = count, 
             color = locality, 
             group = interaction(locality, type), 
             linetype = type)) +
  geom_point(aes(x = year, y = count,
             color = locality, 
             group = interaction(locality, type), 
             linetype = type), ) +
  scale_linetype_manual(values = c(2, 1, 6)) +
  scale_color_manual(values = one_category_palette) +
  scale_y_continuous(limits = c(0,300),
                     label = comma,
                     name = "Number of People") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "", linetype = "", fill = "")
```


## Health and Family Stability

### Mothers with Access to Prenatal Care {.tabset}

#### Trends
```{r}
prenatal_first_trimester <- read_csv("../data/prenatal_first_trimester.csv")

prenatal_first_trimester %>%
  mutate(percent_access_to_prenatal_care = 100 - late_no_prenatal_to_birthrates,
          year = as.character(year)) %>%
  ggplot(aes(x = year, y = percent_access_to_prenatal_care, color = locality, group = locality)) +
  geom_vline(xintercept = "2010", linetype = 2, color = "black") +
  annotate("text", x = 5.2, y = 80, size = 3, hjust = 0, color = "black", 
           label = 
"Affordable Care 
Act (ACA) passed") +
  geom_vline(xintercept = "2019", linetype = 2, color = "black") +
  annotate("text", x = 11.5, y = 85, size = 3, hjust = 0, color = "black", 
           label = 
"Virginia expanded 
Medicaid coverage") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(40, 100),
                     labels = label_percent(scale = 1), 
                     name = "Percent of Mothers") + 
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Low Birth-Weight Births {.tabset}

#### Trends
```{r}
low_birth_weight <- read_csv("../data/low_birth_weight.csv")

low_birth_weight %>%
  mutate(locality = recode(locality,
                          "Albemarle County" = "Albemarle",
                          "Charlottesville City" = "Charlottesville",
                       "Commonwealth Of Virginia" = "Virginia"),
         # year = as.character(year),
         three_yr_period = paste0(as.character(year-1),"-",as.character(year+1))) %>% 
  ggplot(aes(x = three_yr_period, y = pct_3yr, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 60),
                     labels = label_percent(scale = 1), 
                     name = "Avg. Percent of Babies") + 
  scale_x_discrete(name = "Three-Year Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Infant Deaths {.tabset}

#### Trends
```{r}
infant_mortality <- read_csv("../data/infant_mortality.csv")

infant_mortality %>%
  mutate(locality = recode(locality,
                          "Albemarle County" = "Albemarle",
                          "Charlottesville City" = "Charlottesville",
                       "Commonwealth Of Virginia" = "Virginia"),
         three_yr_period = paste0(as.character(year-1),"-",as.character(year+1))) %>% 
  ggplot(aes(x = three_yr_period, y = rate_3yr, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 60),
                     labels = label_percent(scale = 1), 
                     name = "Avg. Percent of Babies") + 
  scale_x_discrete(name = "Three-Year Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

<!-- ### Births to mothers with less than a 12th grade education {.tabset} -->

<!-- #### Trends -->
<!-- ```{r} -->
<!-- births_mothers_nohs <- read_csv("../data/births_mothers_nohs.csv") -->

<!-- births_mothers_nohs %>% -->
<!--   mutate(year = as.character(year)) %>% -->
<!--   ggplot(aes(x = year, y = percent, color = location, group = location)) + -->
<!--   geom_vline(xintercept = "2008", linetype = 2, color = "black") + -->
<!--   annotate("text", x = 9.2, y = 40, size = 3, hjust = 0, color = "black", -->
<!--            label = -->
<!-- "FDA lowers OTC Emergency  -->
<!-- Contraceptive Age to 17") + -->
<!--   geom_line() + -->
<!--   geom_point() + -->
<!--   scale_color_manual(values = three_category_palette) + -->
<!--   scale_y_continuous(limits = c(0, 100), -->
<!--                      labels = label_percent(scale = 1),  -->
<!--                      name = "Percent of Mothers") +  -->
<!--   scale_x_discrete(name = "Year") + -->
<!--   theme_minimal() + -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") + -->
<!--   labs(color = "") -->
<!-- ``` -->

### Teen Pregnancies, Births to Teens {.tabset}

#### Trends
##### Rate of Teen Prenancies
```{r}
teen_pregnancy_birth_rates <- read_csv("../data/teen_pregnancy_birth_rates.csv")

teen_pregnancy_birth_rates %>%
  mutate(locality = recode(locality,
                          "Albemarle County" = "Albemarle",
                          "Charlottesville City" = "Charlottesville",
                       "Commonwealth Of Virginia" = "Virginia"),
         three_yr_period = paste0(as.character(year-1),"-",as.character(year+1))) %>% 
  ggplot(aes(x = three_yr_period, y = pregnancyrate_3yr, color = locality, group = locality)) +
#   geom_vline(xintercept = "2008-2010", linetype = 2, color = "black") +
#   annotate("text", x = 10.2, y = 60, size = 3, hjust = 0, color = "black",
#               label = 
# "2008 FDA lowers OTC 
# Emergency Contraceptive 
# Age to 17") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     # labels = label_percent(scale = 1), 
                     name = "Rate per 1,000") + 
  scale_x_discrete(name = "Three-Year Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Rate of Births to Teens
```{r}
teen_pregnancy_birth_rates %>%
  mutate(locality = recode(locality,
                          "Albemarle County" = "Albemarle",
                          "Charlottesville City" = "Charlottesville",
                       "Commonwealth Of Virginia" = "Virginia"),
         three_yr_period = paste0(as.character(year-1),"-",as.character(year+1))) %>% 
  ggplot(aes(x = three_yr_period, y = birthsrate_3yr, color = locality, group = locality)) +
#   geom_vline(xintercept = "2008-2010", linetype = 2, color = "black") +
#   annotate("text", x = 10.2, y = 60, size = 3, hjust = 0, color = "black",
#               label = 
# "2008 FDA lowers OTC 
# Emergency Contraceptive 
# Age to 17") +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     # labels = label_percent(scale = 1), 
                     name = "Rate per 1,000") + 
  scale_x_discrete(name = "Three-Year Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Sexually Transmitted Infections in Youth {.tabset}

#### Trends
```{r}
youth_sti <- read_csv("../data/youth_sti.csv")

youth_sti %>%
  ggplot(aes(x = year3, y = total_incrate_3yr, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 100),
                     # labels = label_percent(scale = 1), 
                     name = "Rate per 1,000 youth") + 
  scale_x_discrete(name = "Three-Year Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Children in Two-Parent Households {.tabset}

#### Trends
```{r}
children_twoparents <- read_csv("../data/children_twoparents.csv")

children_twoparents %>%
  mutate(locality = str_remove(NAME, " County, Virginia| city, Virginia"), 
         locality = str_trim(locality),
         survey_period = paste0(as.character(year-5), "-", as.character(year))) %>% 
  ggplot(aes(x = survey_period, y = percent, color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::percent, 
                     name = "Percent of Children") + 
  scale_x_discrete(name = "ACS Survey Period") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Divorce {.tabset}

#### Trends
##### Divorce Rate, Source: Virginia Circuit Court
```{r}
divorce_circuit <- read_csv("../data/divorce_circuit.csv")
dc_missing <- data.frame(locality = c("Virginia", "Virginia", "Virginia", "Virginia", "Virginia", "Virginia"),
                       year = c(2014, 2015, 2016, 2017, 2018, 2019))

divorce_circuit %>% 
  bind_rows(dc_missing) %>%
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = divorce_rate, 
             color = locality, 
             group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,10),
                     breaks = c(0,2,4,6,8,10),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Divorce Rate, Source: Virginia Department of Health
```{r}
divorce_vdh <- read_csv("../data/divorce_vdh.csv")

divorce_vdh %>%
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = divorce_rate, 
             color = locality, 
             group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,10),
                     breaks = c(0,2,4,6,8,10),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Investigations and Assessments by Child Protective Services {.tabset}

#### Trends
```{r}
child_welfare_reports <- read_csv("../data/child_welfare_reports.csv")

child_welfare_reports %>%
  mutate(fiscal_year = paste0(as.character(year-1),"-",as.character(year)),
         year = as.character(year)) %>% 
  ggplot(aes(x = year, y = cps_rate, 
             color = locality, 
             group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,100),
                     name = "Rate per 1000") +
  scale_x_discrete(name = " Fiscal Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


### Children in Foster Care {.tabset}

#### Trends
```{r}
foster_care <- read_csv("../data/foster_care.csv")

foster_care %>%
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = fc_rate, 
             color = locality, 
             group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,100),
                     name = "Rate per 1000") +
  scale_x_discrete(name = " Fiscal Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```


## School and Community Disciplinary Actions

### School Reports of Discipline {.tabset}

#### Trends
##### Alcohol and Drug Offenses
```{r}
school_alcdrugs_dcv <- read_csv("../data/school_alcdrugs_dcv.csv")

school_alcdrugs_dcv %>%
  ggplot(aes(x = school_year, y = rate, 
             color = division, group = division)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,50),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Physical Violence
```{r}
school_violence_byoffense_dcv <- read_csv("../data/school_violence_byoffense_dcv.csv")
sv_missing <- data.frame(division = c("Virginia", "Virginia", "Virginia", "Virginia",
                                      "Charlottesville", "Charlottesville", "Charlottesville", "Charlottesville",
                                      "Albemarle", "Albemarle", "Albemarle", "Albemarle"),
                       school_year = c("2013-2014", "2014-2015", "2015-2016", "2016-2017",
                                      "2013-2014", "2014-2015", "2015-2016", "2016-2017",
                                      "2013-2014", "2014-2015", "2015-2016", "2016-2017"))

school_violence_byoffense_dcv %>%
  bind_rows(sv_missing) %>%
  ggplot(aes(x = school_year, y = rate, 
             color = division, group = division)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,100),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

##### Weapons Possession
```{r}
school_weapons_dcv <- read_csv("../data/school_weapons_dcv.csv")

school_weapons_dcv %>%
  ggplot(aes(x = school_year, y = rate, 
             color = division, group = division)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,50),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### School Suspensions {.tabset}

#### Trends
##### Students given an out-of-school suspension (short-term suspension, long-term suspension, or modified expulsion to suspension) per 1000 students enrolled
```{r}
school_suspensions <- read_csv("../data/school_suspensions.csv")

school_suspensions %>%
  ggplot() +
  geom_line(aes(x = school_year, y = rate, 
             color = division, 
             group = interaction(division, source), 
             linetype = source)) +
  geom_point(aes(x = school_year, y = rate, 
             color = division, 
             group = interaction(division, source), 
             linetype = source), ) +
  scale_color_manual(values = three_category_palette) +
  scale_linetype_manual(values = c(2, 1)) +
  scale_y_continuous(limits = c(0,500),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "School Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "", linetype = "")
```

### Juvenile Delinquency Judgments {.tabset}

#### Trends
```{r}
juvenile_delinquency <- read_csv("../data/juvenile_delinquency.csv")

juvenile_delinquency %>%
  mutate(year = as.character(year)) %>% 
  ggplot(aes(x = year, y = rate, 
             color = locality, group = locality)) +
  geom_line() +
  geom_point() +
  scale_color_manual(values = three_category_palette) +
  scale_y_continuous(limits = c(0,100),
                     name = "Rate per 1000") +
  scale_x_discrete(name = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position="top") +
  labs(color = "")
```

### Children in Need of Supervision {.tabset}

#### Trends

### Underage Alcohol Arrests {.tabset}

#### Trends

### Arrests for Violent Crimes {.tabset}

#### Trends

## Contributions
